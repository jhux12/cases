<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rewards | Packly.gg</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at top center, #1a1a2e, #0f0f12);
      color: white;
      overflow-x: hidden;
    }
    .glow-box {
      background: linear-gradient(145deg, #2b2b3a, #12121b);
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 2rem;
      transition: transform 0.3s ease;
    }
    .glow-box:hover {
      transform: scale(1.02);
      box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
    }
    .bounce-icon {
      animation: bounce 1.5s infinite;
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .pulse {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); }
      70% { box-shadow: 0 0 0 20px rgba(255, 215, 0, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
    }
  </style>
</head>
<body class="min-h-screen">

<header></header>

<section class="pt-32 px-6 text-center">
  <div class="max-w-3xl mx-auto glow-box">
    <div class="flex flex-col items-center space-y-4">
      <i class="fas fa-gift fa-4x text-yellow-400 bounce-icon"></i>
      <h1 class="text-3xl font-bold">ðŸŽ‰ Daily Rewards</h1>
      <p class="text-gray-300 text-sm">Claim your bonus and build your streak every 24 hours!</p>
      <p id="countdown-timer" class="text-xs text-yellow-300 hidden"></p>
      <button id="claim-bonus" class="bg-yellow-500 hover:bg-yellow-400 text-black font-bold px-6 py-2 rounded-full transition-all duration-300 pulse">Claim Bonus</button>
      
      <div class="w-full mt-6">
        <h2 class="text-xl font-semibold mb-4">ðŸ”¥ Streak Progress</h2>
        <div id="streak-grid" class="grid grid-cols-7 gap-3 justify-center"></div>
      </div>
    </div>
  </div>
</section>

<div id="toast" class="toast fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-xl hidden z-50">âœ… Bonus claimed! Coins added to your balance.</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCyRm6dWH-fAmfWy83zLTrPFVi9Ny8gyxE",
    authDomain: "cases-e5b4e.firebaseapp.com",
    databaseURL: "https://cases-e5b4e-default-rtdb.firebaseio.com",
    projectId: "cases-e5b4e",
    storageBucket: "cases-e5b4e.appspot.com",
    messagingSenderId: "22502548396",
    appId: "1:22502548396:web:aac335672c21f07524d009"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  auth.onAuthStateChanged(async user => {
    if (!user) return window.location.href = 'auth.html';

    const userRef = db.ref('users/' + user.uid);
    const snapshot = await userRef.once('value');
    const data = snapshot.val() || {};
    const streakGrid = document.getElementById('streak-grid');
    const currentStreak = data.streak || 0;
    const rewards = [15, 20, 25, 30, 35, 40, 45];

    rewards.forEach((reward, index) => {
      const box = document.createElement('div');
      box.className = `p-3 rounded-xl text-xs font-bold text-white ${index < currentStreak ? 'bg-yellow-500' : 'bg-gray-700'}`;
      box.innerHTML = `Day ${index + 1}<br>+${reward} ðŸª™`;
      streakGrid.appendChild(box);
    });

    const claimButton = document.getElementById('claim-bonus');
    const toast = document.getElementById('toast');
    const countdown = document.getElementById('countdown-timer');

    const now = Date.now();
    const lastClaim = data.lastBonusClaim || 0;
    const delay = 24 * 60 * 60 * 1000;
    const timeSinceLastClaim = now - lastClaim;

    if (timeSinceLastClaim > delay * 2) {
      await userRef.update({ streak: 0 });
    }

    if (now - lastClaim < delay) {
      claimButton.disabled = true;
      claimButton.innerText = "Come back later";
      countdown.classList.remove("hidden");
      setInterval(() => {
        const remaining = delay - (Date.now() - lastClaim);
        if (remaining <= 0) return location.reload();
        const h = Math.floor(remaining / (1000 * 60 * 60));
        const m = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((remaining % (1000 * 60)) / 1000);
        countdown.innerText = `Next bonus in ${h}h ${m}m ${s}s`;
      }, 1000);
    }

    claimButton.onclick = async () => {
      if (Date.now() - lastClaim < delay) return;
      const newStreak = (data.streak || 0) >= 7 ? 1 : (data.streak || 0) + 1;
      const bonus = 10 + 5 * newStreak;
      await userRef.update({
        balance: (data.balance || 0) + bonus,
        lastBonusClaim: Date.now(),
        streak: newStreak
      });
      toast.innerText = `âœ… Bonus claimed! ${bonus} coins added!`;
      toast.classList.remove('hidden');
      setTimeout(() => toast.classList.add('hidden'), 3000);
      claimButton.disabled = true;
      claimButton.innerText = "Come back later";
    };
  });
</script>

<script src="scripts/header.js"></script>
<script src="scripts/navbar.js"></script>
<script src="scripts/topup.js"></script>
</body>
</html>
