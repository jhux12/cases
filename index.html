<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Packly.gg — Hero Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="scripts/firebase-config.js"></script>
  <style>
    /* --- HERO BACKDROP --- */
    .hero-bg {
      background: radial-gradient(1200px 600px at 50% 20%, rgba(108,92,231,0.25), transparent 60%),
                  radial-gradient(900px 500px at 20% 80%, rgba(0,153,255,0.18), transparent 60%),
                  radial-gradient(900px 500px at 80% 80%, rgba(255,77,216,0.18), transparent 60%),
                  linear-gradient(180deg, #0c0f1a 0%, #0a0d18 60%, #070a14 100%);
      position: relative;
      overflow: hidden;
    }
    .hero-bg:before, .hero-bg:after {
      content: "";
      position: absolute;
      inset: -30%;
      background:
        repeating-linear-gradient(120deg, rgba(255,255,255,0.02) 0 2px, transparent 2px 8px);
      filter: blur(2px);
      opacity: .4;
      pointer-events: none;
      transform: rotate(5deg);
    }
    .hero-bg:after {
      transform: rotate(-8deg) scale(1.2);
      opacity: .25;
    }

    /* --- SPINNER RAIL --- */
    .spin-viewport {
      mask-image: linear-gradient(90deg, transparent 0%, black 14%, black 86%, transparent 100%);
      -webkit-mask-image: linear-gradient(90deg, transparent 0%, black 14%, black 86%, transparent 100%);
    }
    .spin-track {
      will-change: transform;
    }

    /* --- CARD TILE --- */
    .card {
      width: 220px;
      height: 320px;
      border-radius: 16px;
      background: linear-gradient(180deg,#1a1f2f,#121622);
      box-shadow:
        0 12px 30px rgba(0,0,0,.55),
        inset 0 0 0 1px rgba(255,255,255,.05);
      position: relative;
      overflow: hidden;
    }
    .card::after { /* foil shimmer */
      content: "";
      position: absolute; inset: 0;
      background: conic-gradient(from 180deg at 50% 50%,
        rgba(255,255,255,0) 0deg, rgba(255,255,255,0.15) 25deg,
        rgba(255,255,255,0) 60deg, rgba(255,255,255,0.1) 120deg,
        rgba(255,255,255,0) 200deg);
      mix-blend-mode: screen;
      opacity: .75;
      pointer-events: none;
    }
    .card img {
      width: 100%; height: 100%; object-fit: cover; display: block;
      filter: saturate(1.08) contrast(1.05);
    }
    .glow {
      box-shadow:
        0 0 0 2px rgba(108,92,231,.6),
        0 0 32px 8px rgba(108,92,231,.35),
        0 0 80px 16px rgba(9,153,255,.18);
      transform: scale(1.04) translateY(-2px);
    }

    /* --- CENTER MARKER --- */
    .center-pin {
      position: absolute; left: 50%; top: 50%;
      width: 72px; height: 72px;
      border-radius: 50%; transform: translate(-50%,-50%);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.08),
                  0 0 0 2px rgba(255,77,216,.18);
      pointer-events: none;
    }
    .center-pin:after {
      content: "";
      position: absolute; left: 50%; top: -28px;
      width: 0; height: 0; transform: translateX(-50%);
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 14px solid rgba(255,255,255,0.9);
      filter: drop-shadow(0 2px 6px rgba(255,255,255,.45));
    }

    /* --- CTA placeholders (so you can wire your real buttons) --- */
    .btn-ghost {
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,.12);
    }

    /* prefer-reduced-motion: keep it gentle */
    @media (prefers-reduced-motion: reduce) {
      .spin-track { transition: none !important; }
    }
  </style>
</head>
<body class="bg-[#070a14] text-white">
  <!-- HERO -->
  <section class="hero-bg relative w-full min-h-[720px] flex items-center justify-center">
    <!-- HEADLINE -->
    <div class="absolute top-16 w-full px-6 text-center">
      <h1 class="mx-auto max-w-5xl text-4xl md:text-6xl font-extrabold tracking-tight leading-tight">
        DISCOVER, OPEN & COLLECT
        <span class="block text-transparent bg-clip-text bg-gradient-to-r from-[#6C5CE7] via-[#09F] to-[#FF4DD8]">
          POKÉMON CARDS
        </span>
      </h1>
      <p class="mt-4 opacity-75 text-lg">Packly.gg — premium case opening with provably fair spins.</p>
    </div>

    <!-- SPINNER -->
    <div class="relative w-full max-w-6xl mt-16 px-4">
      <div class="spin-viewport relative mx-auto overflow-hidden rounded-2xl border border-white/10 bg-black/20 backdrop-blur-sm p-4">
        <div id="spinTrack" class="spin-track flex gap-4 will-change-transform"></div>
        <div class="center-pin"></div>
      </div>
      <!-- CTA placeholders -->
      <div class="mt-8 flex items-center justify-center gap-3">
        <a href="/signup" class="btn-ghost rounded-xl px-6 py-3 text-lg font-semibold hover:bg-white/10 transition">
          Sign up now
        </a>
        <a href="/auth/google" class="btn-ghost rounded-xl px-6 py-3 text-lg font-semibold hover:bg-white/10 transition">
          Continue with Google
        </a>
      </div>
    </div>

    <!-- SUBTLE STARDUST -->
    <div class="pointer-events-none absolute inset-0">
      <div class="absolute inset-0 animate-pulse opacity-30" style="
        background: radial-gradient(2px 2px at 20% 30%, #fff 50%, transparent 55%),
                    radial-gradient(1.5px 1.5px at 60% 40%, #fff 50%, transparent 55%),
                    radial-gradient(1.7px 1.7px at 80% 70%, #fff 50%, transparent 55%),
                    radial-gradient(1.2px 1.2px at 35% 80%, #fff 50%, transparent 55%);
        "></div>
    </div>
  </section>

  <script>
    /***********************
     * HERO SPINNER DEMO  *
     ***********************
     * - Fetch high-tier prizes (legendary & ultra rare) like Best Drops
     * - Build a scrolling track
     * - Periodically spin and land on a legendary card
     */

    const CARD_W = 220;
    const GAP = 16;
    const TILE_W = CARD_W + GAP;

    const track = document.getElementById('spinTrack');
    const cards = []; // will store {img, rarity}
    let tiles = [];

    let offset = 0;
    let baseSpeed = 0.6;
    let speed = baseSpeed;
    let demoLock = false;
    let lastTs = performance.now();
    let tilesCount = 0;
    let trackPx = 0;

    function buildTrack(prizes) {
      const tripled = [...prizes, ...prizes, ...prizes];
      tripled.forEach(p => {
        const tile = document.createElement('div');
        tile.className = 'card select-none';
        tile.style.flex = '0 0 auto';
        tile.style.width = CARD_W + 'px';
        tile.innerHTML = `<img src="${p.img}" alt="" loading="lazy" draggable="false">`;
        track.appendChild(tile);
        cards.push(p);
      });
      tiles = Array.from(track.children);
      tilesCount = tiles.length;
      trackPx = tilesCount * TILE_W;
    }

    function loop(ts) {
      const dt = ts - lastTs;
      lastTs = ts;
      offset -= speed * dt;
      if (offset < -trackPx) offset += trackPx;
      track.style.transform = `translateX(${offset}px)`;
      requestAnimationFrame(loop);
    }

    function centerTargetIndex(idx) {
      const viewport = track.parentElement.getBoundingClientRect();
      const heroCenterX = viewport.width / 2;
      const tileCenterX = idx * TILE_W + CARD_W / 2;
      return heroCenterX - tileCenterX;
    }

    async function demoOpen() {
      if (demoLock) return;
      demoLock = true;

      const legends = cards
        .map((c, i) => ({ i, rarity: c.rarity }))
        .filter(o => o.rarity === 'legendary');
      if (!legends.length) {
        demoLock = false;
        return;
      }
      const idx = legends[Math.floor(Math.random() * legends.length)].i;

      speed = baseSpeed * 8;
      await new Promise(r => setTimeout(r, 600));

      const targetOffset = centerTargetIndex(idx);
      const startOffset = offset;
      const delta = startOffset - targetOffset;
      const duration = 1600;
      const start = performance.now();
      speed = 0;

      function easeOutCubic(t) {
        return 1 - Math.pow(1 - t, 3);
      }

      function animate(ts) {
        const t = Math.min(1, (ts - start) / duration);
        const eased = easeOutCubic(t);
        offset = startOffset - delta * eased;
        if (t < 1) {
          requestAnimationFrame(animate);
        } else {
          tiles.forEach(tile => tile.classList.remove('glow'));
          tiles[idx % tiles.length].classList.add('glow');
          setTimeout(() => { speed = baseSpeed; }, 1200);
          demoLock = false;
        }
      }
      requestAnimationFrame(animate);
    }

    function scheduleDemo() {
      demoOpen();
      setInterval(demoOpen, 5000);
    }

    function fetchHighTierPrizes() {
      return firebase.database().ref('cases').once('value').then(snap => {
        const data = snap.val() || {};
        const highTier = [];
        Object.values(data).forEach(caseInfo => {
          (caseInfo.prizes || []).forEach(p => {
            const rarity = (p.rarity || '').toLowerCase();
            if (rarity === 'ultra rare' || rarity === 'legendary') {
              highTier.push({ img: p.image, rarity });
            }
          });
        });
        return highTier;
      });
    }

    fetchHighTierPrizes().then(prizes => {
      if (!prizes.length) return;
      buildTrack(prizes);
      requestAnimationFrame(loop);
      scheduleDemo();
    });
  </script>
</body>
</html>
